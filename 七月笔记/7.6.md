# 目录
## makefile
> 自动化变量
> 目标文件搜索


# makefile
## 自动化变量
在 Makefile 中描述规则时，依赖文件和目标文件是**变动**的，显然在命令中不能出现具体的文件名称，否则模式规则将失去意义。
|自动化变量|	说明|
|:----:|:----:|
|$@|	表示规则的目标文件名。如果目标是一个文档文件（Linux 中，一般成 `.a` 文件为文档文件，也成为静态的库文件），那么它代表这个文档的文件名。在多目标模式规则中，它代表的是触发规则被执行的文件名。|
|$%	|当目标文件是一个静态库文件时，代表静态库的一个成员名。|
|$<	|规则的第一个依赖的文件名。如果是一个目标文件使用隐含的规则来重建，则它代表由隐含规则加入的第一个依赖文件。|
|$?	|所有比目标文件更新的依赖文件列表，空格分隔。如果目标文件时静态库文件，代表的是库文件（`.o` 文件）。|
|$^|	代表的是所有依赖文件列表，使用空格分隔。如果目标是静态库文件，它所代表的只能是所有的库成员（`.o` 文件）名。一个文件可重复的出现在目标的依赖中，变量`$^`只记录它的第一次引用的情况。就是说变量`$^`会去掉重复的依赖文件。|
|$+	|类似`$^`，但是它保留了依赖文件中重复出现的文件。主要用在程序链接时库的交叉引用场合。|
|$*	|在模式规则和静态模式规则中，代表“茎”。“茎”是目标模式中`%`所代表的部分（当文件名中存在目录时，“茎”也包含目录部分）。|

实例1：
```
test:test.o test1.o test2.o
         gcc -o $@ $^
test.o:test.c test.h
         gcc -o $@ $<
test1.o:test1.c test1.h
         gcc -o $@ $<
test2.o:test2.c test2.h
         gcc -o $@ $<
```
这个规则模式中用到了 `$@` 、`$<` 和 `$^` 这三个自动化变量，对比之前写的 Makefile 中的命令，我们可以发现 `$@` 代表的是目标文件test，`$^`代表的是依赖的文件，`$<`代表的是依赖文件中的第一个。
我们在执行 make 的时候，make 会自动识别命令中的自动化变量，并自动实现自动化变量中的值的替换，这个类似于编译C语言文件的时候的预处理的作用。
![1657074521(1)](https://user-images.githubusercontent.com/63440757/177454936-8c53a2f0-e1f0-4861-b00e-c8859a0d52fd.png)

实例2：
```
lib:test.o test1.o test2.o
    ar r $?
```
假如我们要做一个库文件，库文件的制作依赖于这三个文件。当修改了其中的某个依赖文件，在命令行执行 make 命令，库文件 `lib` 就会自动更新。`$?` 表示修改的文件。

## 目标文件搜索（VPATH和vpath）
VPATH 和 vpath 的区别：VPATH 是变量，更具体的说是环境变量，Makefile 中的一种特殊变量，使用时需要指定文件的路径；  
vpath 是关键字，按照模式搜索，也可以说成是选择搜索。搜索的时候不仅需要加上文件的路径，还需要加上相应限制的条件。
### VPATH的使用
在 Makefile 中可以这样写：
```
VPATH := src
```
我们可以这样理解，把 src 的值赋值给变量 VPATH，所以在执行 make 的时候会从 src 目录下找我们需要的文件。

当存在多个路径的时候我们可以这样写：
```
VPATH := src car
```
或者是
```
VPATH := src:car
```
多个路径之间要使用空格或者是冒号隔开，表示在多个路径下搜索文件。搜索的顺序为我们书写时的顺序，拿上面的例子来说，我们应该先搜索 src 目录下的文件，再搜索 car 目录下的文件。
注意：无论你定义了多少路径，make 执行的时候会先搜索当前路径下的文件，当前目录下没有我们要找的文件，才去 VPATH 的路径中去寻找。如果当前目录下有我们要使用的文件，那么 make 就会使用我们当前目录下的文件。

实例：
```
VPATH=src car
test:test.o
    gcc -o $@ $^
```
假设 test.c 文件没有在当前的目录而在当前文件的子目录 "src" 或者是 "car" 下，程序执行是没有问题的，但是生成的 test 的文件没有在定义的子目录文件中而是在当前的目录下，当然生成文件路径可以指定。
### vpath的使用
学习了 VPATH的使用，我们再来了解一下关键字搜索 vpath 的使用，这种搜索方式一般被称作选择性搜索。
使用上的区别我们可以这样理解：VPATH 是搜索路径下所有的文件，而 vpath 更像是添加了限制条件，会过滤出一部分再去寻找。
 
具体用法：
1) vpath PATTERN DIRECTORIES 
2) vpath PATTERN
3) vpath
4) 搜索的条件中可以包含模式字符`%`

( PATTERN：可以理解为要寻找的条件，DIRECTORIES：寻找的路径 )

首先是用法一，命令格式如下：
```
vpath test.c src
```
可以这样理解，在 src 路径下搜索文件 `test.c`。多路径的书写规则如下：
`vpath test.c src car`         
或者是
`vpath test.c src : car`

多路径的用法其实和 VPATH 差不多，都是使用空格或者是冒号分隔开，搜索路径的顺序是先 src 目录，然后是 car 目录。

其次是用法二，命令格式如下：
```
vpath test.c
```
用法二的意思是清除符合文件 test.c 的搜索目录。

最后是用法三，命令格式如下：
```
vpath
```
vpath 单独使的意思是清除所有已被设置的文件搜索路径。
