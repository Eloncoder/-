# Shell
## shell简单编写
```
#!/bin/bash
echo "Hello World !"
```
> `#!` 是一个约定的标记，它告诉系统这个脚本需要什么解释器来执行，即使用哪一种 Shell。
## 运行 Shell 脚本有两种方法：
### 1. 作为可执行程序

将上面的代码保存为 test.sh，并 cd 到相应目录：
```
chmod +x ./test.sh  #使脚本具有执行权限
./test.sh  #执行脚本
```
注意，一定要写成 `./test.sh`，而不是 `test.sh`，运行其它二进制的程序也一样；  
直接写 `test.sh`，linux 系统会去 PATH 里寻找有没有叫 test.sh 的；  
而只有 `/bin`, `/sbin`, `/usr/bin`，`/usr/sbin` 等在 PATH 里，你的当前目录通常不在 PATH 里，所以写成 `test.sh` 是会找不到命令的；  
要用 `./test.sh` 告诉系统说，就在当前目录找。

### 2. 作为解释器参数

这种运行方式是，直接运行解释器，其参数就是 shell 脚本的文件名，如：
```
/bin/sh test.sh
/bin/php test.php
```
## shell变量
### 定义变量
```
variable=value
variable='value'
variable="value"
```
### 使用变量
```
author="严长生"
echo $author
echo ${author}
```
变量名外面的花括号`{ }`是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界，比如下面这种情况：
```
skill="Java"
echo "I am good at ${skill}Script"
```
如果不给 skill 变量加花括号，写成`echo "I am good at $skillScript"`，解释器就会把 `$skillScript` 当成一个变量（其值为空），代码执行结果就不是我们期望的样子了。  

>推荐给所有变量加上花括号`{ }`，这是个良好的编程习惯。

### 单引号和双引号的区别
```
#!/bin/bash
url="http://c.biancheng.net"
website1='C语言中文网：${url}'
website2="C语言中文网：${url}"
echo $website1
echo $website2
```
运行结果：
```
C语言中文网：${url}
C语言中文网：http://c.biancheng.net
```
以单引号`' '`包围变量的值时，单引号里面是什么就输出什么，即使内容中有变量和命令（命令需要反引起来）也会把它们原样输出；  
这种方式比较适合定义显示纯字符串的情况，即不希望解析变量、命令等的场景。  

以双引号`" "`包围变量的值时，输出时会先解析里面的变量和命令，而不是把双引号中的变量名和命令原样输出；  
这种方式比较适合字符串中附带有变量和命令并且想将其解析后再输出的变量定义。

### 将命令的结果赋值给变量
常见的有以下两种方式：
```
variable=`command`
variable=$(command)
```
第一种方式把命令用反引号包围起来，反引号和单引号非常相似，容易产生混淆，所以不推荐使用这种方式；  
第二种方式把命令用`$()`包围起来，区分更加明显，所以推荐使用这种方式。  

例如，我在 `code` 目录中创建了一个名为 `log.txt` 的文本文件，用来记录我的日常工作。  
下面的代码中，使用 `cat` 命令将 `log.txt` 的内容读取出来，并赋值给一个变量，然后使用 `echo` 命令输出。
```
[mozhiyan@localhost ~]$ cd code
[mozhiyan@localhost code]$ log=$(cat log.txt)    // 将命令 `cat log.txt` 的结果赋值给 `log`
[mozhiyan@localhost code]$ echo $log
[2017-09-10 06:53:22] 严长生正在编写Shell教程
[mozhiyan@localhost code]$ log=`cat log.txt`
[mozhiyan@localhost code]$ echo $log
[2017-09-10 06:53:22] 严长生正在编写Shell教程
[mozhiyan@localhost code]$ 
```

### 只读变量
使用 `readonly` 命令可以将变量定义为只读变量，只读变量的值不能被改变。  

下面的例子尝试更改只读变量，结果报错：
```
#!/bin/bash
myUrl="http://see.xidian.edu.cn/cpp/shell/"
readonly myUrl
myUrl="http://see.xidian.edu.cn/cpp/danpianji/"
```
运行脚本，结果如下：
```
/bin/sh: NAME: This variable is read only.
```
### 删除变量
使用 `unset` 命令可以删除变量。语法：
```
unset variable_name
```
变量被删除后不能再次使用；  
`unset` 命令不能删除只读变量。

举个例子：
```
#!/bin/sh
myUrl="http://see.xidian.edu.cn/cpp/u/xitong/"
unset myUrl
echo $myUrl
```
上面的脚本没有任何输出。

### 变量类型
运行shell时，会同时存在三种变量：
1. 局部变量
局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。
2. 环境变量
所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量。
3. shell变量
shell变量是由shell程序设置的特殊变量。shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行


### 特殊变量
|变量|含义|
|:----:|:----|
| $0 |当前脚本的文件名|
| $n |传递给脚本或函数的参数。n 是一个数字，表示第几个参数。例如，第一个参数是$1，第二个参数是$2|
| $# |传递给脚本或函数的参数个数|
| $* |传递给脚本或函数的所有参数|
| $@ |传递给脚本或函数的所有参数。被双引号(" ")包含时，与 $* 稍有不同，下面将会讲到|
| $? |上个命令的退出状态，或函数的返回值|
| $$ |当前Shell进程ID。对于 Shell 脚本，就是这些脚本所在的进程ID|

### 命令行参数
运行脚本时传递给脚本的参数称为命令行参数。  
命令行参数用 `$n` 表示。例如，`$1` 表示第一个参数，`$2` 表示第二个参数，依次类推。  

请看下面的脚本：
```
#!/bin/bash
echo "File Name: $0"
echo "First Parameter : $1"
echo "First Parameter : $2"
echo "Quoted Values: $@"
echo "Quoted Values: $*"
echo "Total Number of Parameters : $#"
```
运行结果：
```
$./test.sh Zara Ali
File Name : ./test.sh
First Parameter : Zara    // 第一个参数为：Zara
Second Parameter : Ali    // 第二个参数为：Ali
Quoted Values: Zara Ali
Quoted Values: Zara Ali
Total Number of Parameters : 2
```


### 退出状态
`$?` 可以获取上一个命令的退出状态。所谓退出状态，就是上一个命令执行后的返回结果。

退出状态是一个数字，一般情况下，大部分命令执行成功会返回 `0`，失败返回 `1`；  
不过，也有一些命令返回其他值，表示不同类型的错误。

下面例子中，命令成功执行：
```
$./test.sh Zara Ali
File Name : ./test.sh
First Parameter : Zara
Second Parameter : Ali
Quoted Values: Zara Ali
Quoted Values: Zara Ali
Total Number of Parameters : 2
$echo $?
0
$
```
